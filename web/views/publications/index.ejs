<!DOCTYPE html>
<html lang="es">

<head>
    <%- include('../partials/head', { title: 'Publicacions' }) %>
</head>

<body>

    <% var filtrosPub = `
    <div class="radio-filters" style="display: flex; gap: 15px; align-items: center;">
        <span style="font-weight: bold; color: #555;">Estat:</span>
        
        <label style="cursor: pointer;">
            <input type="radio" name="filterValidation" value="all" onchange="filterPublications()" 
            ${(typeof currentFilters === 'undefined' || !currentFilters.validated || currentFilters.validated === 'all') ? 'checked' : ''}> 
            Tots
        </label>

        <label style="cursor: pointer;">
            <input type="radio" name="filterValidation" value="true" onchange="filterPublications()" 
            ${(typeof currentFilters !== 'undefined' && currentFilters.validated === 'true') ? 'checked' : ''}> 
            Validats
        </label>

        <label style="cursor: pointer;">
            <input type="radio" name="filterValidation" value="false" onchange="filterPublications()" 
            ${(typeof currentFilters !== 'undefined' && currentFilters.validated === 'false') ? 'checked' : ''}> 
            Pendents
        </label>
    </div>
    `; %>

        <%- include('../partials/headerList', { title: 'Publicacions' , createUrl: '/publications/create' ,
            createLabel: 'Afegir nova publicació' , extraFilters: filtrosPub }) %>

            <main class="main-content">

                <%- include('../partials/search', { searchFunction: 'filterPublications' ,
                    placeholder: 'Buscar per nom, descripció...' , resetUrl: '/publications' , currentFilters:
                    currentFilters }) %>

                    <input type="hidden" id="filterValidation" value="all">

                    <section class="list">
                        <% if (publications && publications.length> 0) { %>
                            <% publications.forEach(publication=> { %>
                                <article class="card">
                                    <div class="card-info">
                                        <h3 class="card-title">
                                            <%= publication.title %>
                                        </h3>
                                        <p class="card-description">
                                            <%= publication.description %>
                                        </p>
                                    </div>
                                    <div class="card-actions">
                                        <a href="/publications/edit/<%= publication.id_publication %>"
                                            class="edit-button">
                                            <img src="/images/icons/edit_icon.png" alt="Editar">Editar
                                        </a>
                                        <button type="button" class="delete-button"
                                            onclick="deletePublication('<%= publication.id_publication %>')">
                                            <img src="/images/icons/trash-2-64.png" alt="Borrar">Eliminar
                                        </button>
                                        <% if (publication.validated) { %>
                                            <button class="validated-button" disabled>
                                                <img src="/images/icons/check-icon.png" alt="Validat">Validat
                                            </button>
                                            <% } else { %>
                                                <button class="validation-button"
                                                    onclick="validatePublication('<%= publication.id_publication %>')">
                                                    <img src="/images/icons/check-icon.png" alt="Validar">Validar
                                                </button>
                                                <% } %>
                                    </div>
                                </article>
                                <% }) %>
                                    <% } else { %>
                                        <p class="no-architects">No hi ha publicacions disponibles.</p>
                                        <% } %>
                    </section>

                    <%- include('../partials/pagination', { route: '/publications' , pagination: pagination, filters:
                        currentFilters }) %>

            </main>
            <script src="/scripts/publications/index.js"></script>
            <script>
                sessionStorage.setItem('publications_filters', window.location.search);
            </script>
</body>

</html>