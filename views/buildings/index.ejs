<!DOCTYPE html>
<html lang="es">

<head>
    <%- include('../partials/head', { title: 'Llistat de construccions' }) %>
</head>

<body>

    <% var filtrosHtml=` <div class="filters-flex-container">

        <div class="filter-group">
            <span class="filter-title">Estat:</span>
            <div class="filter-options">
                <label class="radio-label">
                    <input type="radio" name="filterValidation" value="all" onchange="filterBuildings()" ${(typeof
                        currentFilters==='undefined' || !currentFilters.validated || currentFilters.validated==='all' )
                        ? 'checked' : '' }>
                    Tots
                </label>

                <label class="radio-label">
                    <input type="radio" name="filterValidation" value="true" onchange="filterBuildings()" ${(typeof
                        currentFilters !=='undefined' && currentFilters.validated==='true' ) ? 'checked' : '' }>
                    Validats
                </label>

                <label class="radio-label">
                    <input type="radio" name="filterValidation" value="false" onchange="filterBuildings()" ${(typeof
                        currentFilters !=='undefined' && currentFilters.validated==='false' ) ? 'checked' : '' }>
                    Pendents
                </label>
            </div>
        </div>

        <div class="filter-group">
            <span class="filter-title">Imatge:</span>
            <div class="filter-options">
                <label class="radio-label">
                    <input type="radio" name="filterImage" value="all" onchange="filterBuildings()" ${(typeof
                        currentFilters==='undefined' || !currentFilters.image || currentFilters.image==='all' )
                        ? 'checked' : '' }>
                    Totes
                </label>

                <label class="radio-label">
                    <input type="radio" name="filterImage" value="true" onchange="filterBuildings()" ${(typeof
                        currentFilters !=='undefined' && currentFilters.image==='true' ) ? 'checked' : '' }>
                    Amb
                </label>

                <label class="radio-label">
                    <input type="radio" name="filterImage" value="false" onchange="filterBuildings()" ${(typeof
                        currentFilters !=='undefined' && currentFilters.image==='false' ) ? 'checked' : '' }>
                    Sense
                </label>
            </div>
        </div>

        <div class="filter-group">
            <span class="filter-title">Publicació:</span>
            <select id="filterPublication" class="header-select filter-select-pub" onchange="filterBuildings()">
                <option value="all">Totes les publicacions</option>
                ${(publications && publications.length > 0) ? publications.map(pub =>
                `<option value="${pub.id_publication}" ${(typeof currentFilters !=='undefined' &&
                    currentFilters.publication==pub.id_publication) ? 'selected' : '' }>${pub.title}</option>`
                ).join('') : ''}
            </select>
        </div>

        </div>
        `; %>

        <%- include('../partials/headerList', { title: 'Construccions' , createUrl: '/buildings/create' ,
            createLabel: 'Afegir nou edifici' , extraFilters: filtrosHtml }) %>

            <main class="main-content buildings-layout">

                <%- include('../partials/search', { searchFunction: 'filterBuildings' ,
                    placeholder: 'Buscar per nom, descripció...' , resetUrl: '/buildings' , currentFilters:
                    currentFilters }) %>

                    <input type="hidden" id="filterValidation" value="all">

                    <section class="list">
                        <% if (buildings && buildings.length> 0) { %>
                            <% buildings.forEach(building=> { %>
                                <article class="card" data-name="<%= building.name %>"
                                    data-description="<%= building.description %>">
                                    <figure class="card-image">
                                        <% if (building.building_images && building.building_images.length> 0) { %>
                                            <img src="<%= building.building_images[0].image_url %>"
                                                alt="<%= building.name %>" class="img_list">
                                            <% } else { %>
                                                <img src="/images/buildings/provisional.png" alt="Imatge provisional"
                                                    class="img_list">
                                                <% } %>
                                    </figure>

                                    <div class="card-info">
                                        <h3 class="card-title">
                                            <%= building.name %>
                                        </h3>
                                        <p class="card-coords">
                                            <%= building.location %>
                                        </p>
                                        <p class="card-date"><i class="fas fa-calendar-alt"></i>
                                            <%= building.construction_year %>
                                        </p>
                                        <p class="card-description">
                                            <%= building.description %>
                                        </p>
                                    </div>

                                    <div class="card-actions">
                                        <a href="/buildings/edit/<%= building.id_building %>" class="edit-button">
                                            <img src="/images/icons/edit_icon.png" alt="Editar"> Editar
                                        </a>
                                        <button type="button" class="delete-button"
                                            data-url="/buildings/delete/<%= building.id_building %>"
                                            data-confirm="Segur que vols eliminar l'edifici <%= building.name %>?">
                                            <img src="/images/icons/trash-2-64.png" alt="Borrar"> Eliminar
                                        </button>
                                        <% if (building.validated) { %>
                                            <button class="validated-button" disabled>
                                                <img src="/images/icons/check-icon.png" alt="Validat">Validat
                                            </button>
                                            <% } else { %>
                                                <button class="validation-button"
                                                    data-url="/buildings/validation/<%= building.id_building %>">
                                                    <img src="/images/icons/check-icon.png" alt="Validar"> Validar
                                                </button>
                                                <% } %>
                                    </div>
                                </article>
                                <% }) %>
                                    <% } else { %>
                                        <p class="no-architects">No hi ha construccions disponibles.</p>
                                        <% } %>
                    </section>

                    <%- include('../partials/pagination', { route: '/buildings' , pagination: pagination, filters:
                        currentFilters }) %>

            </main>
            <script src="/scripts/buildings/index.js"></script>
            <script>
                sessionStorage.setItem('buildings_filters', window.location.search);
            </script>
</body>

</html>